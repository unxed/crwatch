# Свойства и правила разбора текстовых блоков с адресами

Этот документ описывает набор наблюдаемых свойств и правил, которым подчиняются текстовые данные, содержащие перечисления адресов. Цель документа — предоставить исчерпывающее руководство для создания алгоритма, способного корректно разделять такие блоки на отдельные адресные строки.

## I. Базовая структура и предварительная обработка

1.  **Основные разделители.** Адреса или их значимые части отделяются друг от друга запятой (`,`), точкой с запятой (`;`) и символом переноса строки (`\n`). Эти символы являются основными точками для предварительного разделения текста на фрагменты.

2.  **Неадресное содержимое ("мусор").**
    *   **Префиксы:** Любой текст, предшествующий двоеточию (`:`), не является частью адреса (например, `Позиция:`).
    *   **Маркеры списков:** Нумераторы в начале фрагмента (например, `1)` или `2.`) не являются частью адреса.
    *   **Описательные фрагменты:** Аномально длинные фрагменты текста, в которых отсутствуют какие-либо стандартные адресные слова (см. Приложение А), с высокой вероятностью являются неадресным описанием.

## II. Компоненты адреса и их идентификация

Адрес состоит из иерархически упорядоченных компонентов. Ключевым свойством данных является наличие в них специальных слов-идентификаторов (маркеров), которые позволяют определить тип компонента.

3.  **Идентификация по словам-маркерам.** Большинство компонентов однозначно определяются по наличию в них стандартных слов или их сокращений (см. Приложение А).
    *   **Условие:** Слово-маркер должно быть целым словом, а не частью другого (например, `г.` в `г. Москва`, но не `город` в `Нижегородская`).

4.  **Компоненты без явных маркеров.**
    *   **Города федерального значения:** Слова `Москва`, `Санкт-Петербург`, `Севастополь` всегда обозначают компонент "город-регион", даже без `г.`.
    *   **Компонент "Город":** Если фрагмент текста не содержит маркеров и цифр и следует сразу за компонентом "регион" или "район", он является компонентом "город".
    *   **Компонент "Дом":**
        *   Фрагмент, не содержащий маркеров, но содержащий цифры или слова из "закрытого" списка дополнений (`корпус`, `строение` и т.д.), является компонентом дома.
        *   **Неявный номер дома:** Числовой или буквенно-числовой фрагмент, следующий непосредственно за компонентом "улица", также является компонентом "дом".

## III. Правила взаимодействия и разделения компонентов

Это наиболее важный раздел, описывающий неявную грамматику последовательностей компонентов.

5.  **Правило строгого порядка "Улица -> Дом".**
    *   Внутри одного адреса компонент "улица" всегда предшествует компоненту "дом".
    *   **Следствие:** Последовательность `...[Дом] [Улица]...` (например, `д. 5 ул. Ленина`) является структурно невозможной для одного адреса. Появление элемента улицы после элемента дома всегда означает **начало нового, независимого адреса**.

6.  **Правило "Вводных" и "Уточняющих" слов для строений.**
    *   Существует две группы слов для описания строений:
        *   **Вводные:** `дом`, `д.`.
        *   **Уточняющие:** `литера`, `корпус`, `строение` и их сокращения.
    *   **Свойство:** Появление **вводного** слова (`д.`) всегда начинает описание **нового, отдельного строения**. Оно не может быть уточнением к предыдущему.
    *   *Пример:* `...д. 5, д. 6` — это два разных дома. `...д. 5, корпус 6` — это один дом с корпусом.

7.  **Правило структурного подобия для перечислений.**
    *   В перечислениях однотипных элементов часто опускаются все части, кроме изменяющейся.
    *   **Свойство:** Если за компонентом строения (например, `...литера А`) следует короткий фрагмент, **структурно подобный** его последней части (например, `Б`), этот фрагмент начинает описание **нового, отдельного строения, наследуя контекст предыдущего**.
    *   **Подобие определяется по типу:** "число подобно числу", "одиночная буква подобна одиночной букве".
    *   *Пример:* В `...д. 10 литера А; Б` фрагмент `Б` подобен `А` и семантически эквивалентен `д. 10 литера Б`.

8.  **Правило избыточности и сокращения.**
    *   В данных может встречаться избыточное повторение названия улицы после каждого дома.
    *   **Свойство:** Последовательность `[Улица А], [Дом 1] [Улица А]` семантически эквивалентна `[Улица А], [Дом 1]`.
    *   **Следствие:** Повторное появление идентичной фразы-улицы после компонента дома **не начинает** новый адрес, а является избыточным указателем, который можно проигнорировать.

9.  **Правило "Вложенности" населенных пунктов.**
    *   **Свойство:** Если в тексте за одним компонентом "населенный пункт" (например, `г. Саяногорск`) сразу следует другой (например, `рп. Черемушки`), это означает **административную вложенность**, а не начало нового адреса. Второй населенный пункт является уточнением местоположения внутри первого.

10. **Правило "Логического продолжения" для улиц.**
    *   **Свойство:** Если фрагмент текста, не содержащий явных адресных маркеров (например, `5-я Советская`), непосредственно предшествует фрагменту, который является словом-типом улицы (`ул.`, `пр.` и т.д.), то эти два фрагмента составляют **единое целое** — название и тип одной и той же улицы.

11. **Правило "Умного сброса" для городов федерального значения.**
    *   **Свойство:** Города федерального значения (`Москва`, `Санкт-Петербург`) ведут себя как "контейнеры" верхнего уровня. Когда после адреса во вложенном населенном пункте (например, `...г. Колпино, ул. А, д. 1`) следует адрес с улицей без указания нового вложенного пункта (например, `...ул. Б, д. 2`), эта вторая улица (`ул. Б`) относится **к основному городу-контейнеру**, а не к последнему упомянутому вложенному пункту.

## IV. Обработка неоднозначностей

12. **Неоднозначность `д.` (дом или деревня).**
    *   `д.` обозначает **дом**, если в предшествующем тексте уже упоминалась улица или город, **и** во фрагменте с `д.` есть цифры.
    *   В противном случае `д.` обозначает **деревню**.

13. **Неоднозначность `г` (город или литера).**
    *   `г` (или `г.`) обозначает **литеру**, если ему непосредственно предшествует цифра, а после него нет полноценного слова (например, `... 25 Г`).
    *   В противном случае `г` обозначает **город**.

## Приложение А: Базовый список слов-маркеров

*   **Регион:** `обл`, `область`, `край`, `Респ`, `республика`, `АО`
*   **Район:** `р-н`, `район`, `округ`
*   **Населенный пункт:** `г`, `город`, `с`, `село`, `п`, `пос`, `поселок`, `деревня` (`д.`), `рп`
*   **Улица:** `ул`, `улица`, `пр-т`, `пр`, `проспект`, `б-р`, `бульвар`, `пер`, `переулок`, `наб`, `набережная`, `ш`, `шоссе`, `проезд`, `линия`, `дорога`, `квл`, `квартал`, `мкр`, `микрорайон`
*   **Дом:** `дом`, `д.`, `корп`, `корпус`, `к.`, `стр`, `строение`, `литера`, `лит.`
